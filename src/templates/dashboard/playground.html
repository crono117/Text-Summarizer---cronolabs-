{% extends 'base.html' %}

{% block title %}Playground - SummaSaaS{% endblock %}

{% block extra_css %}
<style>
    .char-counter {
        font-variant-numeric: tabular-nums;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Summarization Playground</h1>
                    <p class="mt-2 text-gray-600">Test and experiment with different summarization modes</p>
                </div>
                <a href="{% url 'summarizer:dashboard' %}" class="text-purple-600 hover:text-purple-700 font-medium inline-flex items-center">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Messages -->
        {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
            <div class="{% if message.tags == 'error' %}bg-red-100 border-red-400 text-red-700{% elif message.tags == 'success' %}bg-green-100 border-green-400 text-green-700{% else %}bg-blue-100 border-blue-400 text-blue-700{% endif %} border px-4 py-3 rounded relative mb-3" role="alert">
                <span class="block sm:inline">{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Usage Info Banner -->
        <div class="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-lg shadow-lg p-6 mb-8 text-white">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <svg class="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                    <div>
                        <p class="text-sm font-medium opacity-90">Current Plan: {% if plan %}{{ plan.get_name_display }}{% else %}Free{% endif %}</p>
                        <p class="text-2xl font-bold">{{ characters_remaining|floatformat:0 }} characters remaining</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm opacity-90">out of {{ character_limit|floatformat:0 }} this month</p>
                    {% if plan and plan.name == 'FREE' %}
                    <a href="{% url 'billing:pricing' %}" class="mt-2 inline-block bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition duration-200">
                        Upgrade Plan
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Input Section -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Input Text</h2>

                <form method="POST" id="summarization-form">
                    {% csrf_token %}

                    <!-- Text Input -->
                    <div class="mb-6">
                        <label for="input_text" class="block text-sm font-medium text-gray-700 mb-2">
                            Text to Summarize
                        </label>
                        <textarea
                            id="input_text"
                            name="input_text"
                            rows="12"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"
                            placeholder="Paste or type your text here... (minimum 100 characters recommended)"
                            required
                        >{{ input_text }}</textarea>
                        <div class="flex justify-between mt-2">
                            <p class="text-sm text-gray-500">Minimum 50 characters for best results</p>
                            <p class="text-sm font-medium text-gray-700 char-counter" id="char-count">0 characters</p>
                        </div>
                    </div>

                    <!-- Summarization Mode -->
                    <div class="mb-6">
                        <label for="mode" class="block text-sm font-medium text-gray-700 mb-2">
                            Summarization Mode
                        </label>
                        <select
                            id="mode"
                            name="mode"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        >
                            {% for value, label in mode_choices %}
                            <option value="{{ value }}" {% if mode == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                        <p class="text-sm text-gray-500 mt-2" id="mode-description">
                            Select a mode to see its description
                        </p>
                    </div>

                    <!-- Max Length Slider -->
                    <div class="mb-6">
                        <label for="max_length" class="block text-sm font-medium text-gray-700 mb-2">
                            Maximum Summary Length: <span id="max-length-value" class="font-bold text-purple-600">{{ max_length }}</span> words
                        </label>
                        <input
                            type="range"
                            id="max_length"
                            name="max_length"
                            min="50"
                            max="500"
                            value="{{ max_length }}"
                            step="10"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600"
                        >
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                            <span>50 words</span>
                            <span>500 words</span>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        class="w-full gradient-bg text-white px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition duration-200 flex items-center justify-center"
                    >
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Generate Summary
                    </button>
                </form>
            </div>

            <!-- Output Section -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Summary Output</h2>

                {% if summary_result %}
                <!-- Summary Result -->
                <div class="mb-6">
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 mb-4">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-sm font-medium text-green-700">Summary generated successfully!</p>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-6 mb-4">
                        <p class="text-gray-900 leading-relaxed whitespace-pre-wrap">{{ summary_result.output_text }}</p>
                    </div>

                    <!-- Summary Statistics -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <p class="text-sm text-gray-600 mb-1">Input Length</p>
                            <p class="text-2xl font-bold text-blue-600">{{ summary_result.characters_processed }}</p>
                            <p class="text-xs text-gray-500">characters</p>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 text-center">
                            <p class="text-sm text-gray-600 mb-1">Output Length</p>
                            <p class="text-2xl font-bold text-purple-600">{{ summary_result.output_text|length }}</p>
                            <p class="text-xs text-gray-500">characters</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <p class="text-sm text-gray-600 mb-1">Processing Time</p>
                            <p class="text-2xl font-bold text-green-600">{{ summary_result.processing_time_ms }}</p>
                            <p class="text-xs text-gray-500">milliseconds</p>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-3 mt-6">
                        <button
                            onclick="copyToClipboard()"
                            class="flex-1 bg-purple-100 text-purple-700 px-4 py-2 rounded-lg font-medium hover:bg-purple-200 transition duration-200 flex items-center justify-center"
                        >
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            Copy Summary
                        </button>
                        <button
                            onclick="window.location.reload()"
                            class="flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition duration-200 flex items-center justify-center"
                        >
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            New Summary
                        </button>
                    </div>
                </div>

                {% else %}
                <!-- Placeholder -->
                <div class="flex flex-col items-center justify-center h-full py-12 text-center">
                    <svg class="w-24 h-24 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Your summary will appear here</h3>
                    <p class="text-gray-500 max-w-md">
                        Enter your text on the left, choose your preferred summarization mode and length, then click "Generate Summary" to see the results.
                    </p>

                    <!-- Feature Info -->
                    <div class="mt-8 w-full">
                        <h4 class="font-semibold text-gray-700 mb-3">Available Modes:</h4>
                        <div class="space-y-2 text-left">
                            <div class="bg-blue-50 rounded p-3">
                                <p class="font-medium text-blue-900">Extractive</p>
                                <p class="text-sm text-blue-700">Pulls key sentences directly from the source text</p>
                            </div>
                            <div class="bg-purple-50 rounded p-3">
                                <p class="font-medium text-purple-900">Abstractive</p>
                                <p class="text-sm text-purple-700">Generates new sentences to capture the main ideas</p>
                            </div>
                            <div class="bg-green-50 rounded p-3">
                                <p class="font-medium text-green-900">Hybrid</p>
                                <p class="text-sm text-green-700">Combines both extractive and abstractive techniques</p>
                            </div>
                            <div class="bg-yellow-50 rounded p-3">
                                <p class="font-medium text-yellow-900">Keyword</p>
                                <p class="text-sm text-yellow-700">Extracts and highlights key terms and phrases</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

        </div>

    </div>
</div>

<script>
// Character counter
const textarea = document.getElementById('input_text');
const charCount = document.getElementById('char-count');

function updateCharCount() {
    const count = textarea.value.length;
    charCount.textContent = count.toLocaleString() + ' characters';
}

textarea.addEventListener('input', updateCharCount);
updateCharCount();

// Max length slider
const slider = document.getElementById('max_length');
const sliderValue = document.getElementById('max-length-value');

slider.addEventListener('input', function() {
    sliderValue.textContent = this.value;
});

// Mode descriptions
const modeSelect = document.getElementById('mode');
const modeDescription = document.getElementById('mode-description');

const descriptions = {
    'extractive': 'Extracts the most important sentences directly from your text.',
    'abstractive': 'Generates a new summary by understanding and rephrasing the content.',
    'hybrid': 'Combines both extraction and generation for balanced results.',
    'keyword': 'Identifies and extracts the most important keywords and phrases.'
};

modeSelect.addEventListener('change', function() {
    modeDescription.textContent = descriptions[this.value] || 'Select a mode to see its description';
});

// Initialize description
modeDescription.textContent = descriptions[modeSelect.value] || 'Select a mode to see its description';

// Copy to clipboard function
function copyToClipboard() {
    const summaryText = document.querySelector('.bg-gray-50.rounded-lg.p-6 p').textContent;
    navigator.clipboard.writeText(summaryText).then(function() {
        alert('Summary copied to clipboard!');
    }, function(err) {
        console.error('Could not copy text: ', err);
    });
}
</script>
{% endblock %}
